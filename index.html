<script>
  const apiKey = 'AIzaSyAVXXKVyZu2mk38HoKZlyehPimjfDGQBaw';
  const channelId = 'UC419XwNMLkI5KmVCo9sRPQg';

  function animateCountUp(elementId, endValue) {
    const duration = 1500;
    const start = 0;
    const range = endValue - start;
    const startTime = performance.now();

    function step(currentTime) {
      const progress = Math.min((currentTime - startTime) / duration, 1);
      const value = Math.floor(progress * range + start);
      document.getElementById(elementId).textContent = value.toLocaleString('de-DE');
      if (progress < 1) requestAnimationFrame(step);
    }

    requestAnimationFrame(step);
  }

  async function loadStats() {
    const statsUrl = `https://www.googleapis.com/youtube/v3/channels?part=statistics,snippet&id=${channelId}&key=${apiKey}`;
    const vidsUrl = `https://www.googleapis.com/youtube/v3/search?key=${apiKey}&channelId=${channelId}&part=snippet,id&order=date&maxResults=3&_=${Date.now()}`;

    try {
      const [statsRes, vidsRes] = await Promise.all([
        fetch(statsUrl),
        fetch(vidsUrl)
      ]);
      const statsData = await statsRes.json();
      const vidsData = await vidsRes.json();

      const snippet = statsData.items[0].snippet;
      const stats = statsData.items[0].statistics;

      document.getElementById('channelTitle').textContent = snippet.title;

      const subs = parseInt(stats.subscriberCount, 10);
      const views = parseInt(stats.viewCount, 10);

      animateCountUp('subscriberCount', subs);
      animateCountUp('viewCount', views);

      const nextGoal = Math.ceil(subs / 10) * 10;
      const remaining = nextGoal - subs;
      document.getElementById('goalText').textContent =
        remaining > 0
          ? `Es fehlen noch ${remaining} Abonnent${remaining > 1 ? 'en' : ''} bis ${nextGoal}.`
          : `Ziel erreicht mit ${subs} Abonnenten!`;

      document.getElementById('channelLinkBtn').onclick = () => {
        window.open(`https://www.youtube.com/channel/${channelId}`, '_blank');
      };

      const videosEl = document.getElementById('videos');
      videosEl.innerHTML = "";

      let videoCount = 0;

      vidsData.items.forEach(item => {
        if (item.id.kind === "youtube#video" && item.id.videoId) {
          const iframe = document.createElement('iframe');
          iframe.src = `https://www.youtube.com/embed/${item.id.videoId}`;
          videosEl.appendChild(iframe);
          videoCount++;
        }
      });

      if (videoCount === 0) {
        videosEl.innerHTML = "<p style='color:red'>Fehler beim Laden der Videos. Bitte kontaktieren Sie Jakob, um den Fehler zu überprüfen.</p>";
      }

    } catch (err) {
      console.error("Fehler beim Laden der Daten:", err);
      document.getElementById('videos').innerHTML = "<p style='color:red'>Fehler beim Laden der Videos. Bitte kontaktieren Sie Jakob, um den Fehler zu überprüfen.</p>";
    }
  }

  document.getElementById('refreshBtn').addEventListener('click', loadStats);
  loadStats();

  // Schneeflocken
  let mouseX = window.innerWidth / 2;

  document.addEventListener('mousemove', e => {
    mouseX = e.clientX;
  });

  function createSnowflake() {
    const flake = document.createElement('div');
    flake.className = 'snowflake';
    flake.textContent = '❄️';

    const size = Math.random() * 10 + 10;
    flake.style.fontSize = size + 'px';

    const startX = Math.random() * window.innerWidth;
    flake.style.left = startX + 'px';
    flake.style.top = '-20px';

    document.body.appendChild(flake);

    let y = -20;
    const xSpeed = (mouseX - startX) / 300 + (Math.random() - 0.5);
    let x = startX;

    const fall = setInterval(() => {
      y += 1.5;
      x += xSpeed;
      flake.style.top = y + 'px';
      flake.style.left = x + 'px';

      if (y > window.innerHeight + 20) {
        flake.remove();
        clearInterval(fall);
      }
    }, 16);
  }

  setInterval(createSnowflake, 150);
</script>


